<body>
  <H2>This is a test of the emergency broadcast WEB BLUETOOTH SYSTEM</h2>


<script>

function handleNotification(event) {
  let value = event.target.value;
  let a = [];
  for (let i = 0; i < value.byteLength; i++) {
    a.push('0x' + ('00' + value.getUint8(i).toString(16)).slice(-2));
  }
  console.log('> ' + a.join(' '));
  console.log('> ' + value);
}

async function Run() {
  let serviceUuid = '713d0000-503e-4c75-ba94-3148f18d941e';
  let rxUuid = '713d0002-503e-4c75-ba94-3148f18d941e';
  let txUuid = '713d0003-503e-4c75-ba94-3148f18d941e';

  console.log('Requesting Bluetooth Device...');
  const device = await navigator.bluetooth.requestDevice({
     filters: [{services: [serviceUuid]}]
  });

  console.log('Connecting to GATT Server...');
  const server = await device.gatt.connect();

  console.log('Getting Service...');
  const service = await server.getPrimaryService(serviceUuid);

  console.log('Getting Characteristics...');
  const rx = await service.getCharacteristics(rxUuid);
  console.log(rx);
  console.log('> Rx UUID:  ' + rx.uuid);
  console.log('> Broadcast:            ' + rx.properties.broadcast);
  console.log('> Read:                 ' + rx.properties.read);
  console.log('> Write w/o response:   ' + rx.properties.writeWithoutResponse);
  console.log('> Write:                ' + rx.properties.write);
  console.log('> Notify:               ' + rx.properties.notify);
  console.log('> Indicate:             ' + rx.properties.indicate);
  console.log('> Signed Write:         ' + rx.properties.authenticatedSignedWrites);
  console.log('> Queued Write:         ' + rx.properties.reliableWrite);
  console.log('> Writable Auxiliaries: ' + rx.properties.writableAuxiliaries);

  const tx = await service.getCharacteristics(txUuid);
  console.log('> Tx UUID:  ' + tx.uuid);
  console.log('> Broadcast:            ' + tx.properties.broadcast);
  console.log('> Read:                 ' + tx.properties.read);
  console.log('> Write w/o response:   ' + tx.properties.writeWithoutResponse);
  console.log('> Write:                ' + tx.properties.write);
  console.log('> Notify:               ' + tx.properties.notify);
  console.log('> Indicate:             ' + tx.properties.indicate);
  console.log('> Signed Write:         ' + tx.properties.authenticatedSignedWrites);
  console.log('> Queued Write:         ' + tx.properties.reliableWrite);
  console.log('> Writable Auxiliaries: ' + tx.properties.writableAuxiliaries);

  await rx.StartNotifications();
  rx.addEventListener('characteristicvaluechanged', handleNotification);
}

</script>

<button type=button onclick='Run()'>Connect</button>
</body>

